<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Refactorización con pruebas I - Fullstack JS</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Refactorización con pruebas I | Fullstack JS</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Refactorización con pruebas I" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="/docs/06-testing-backend.html" /> <meta property="og:url" content="/docs/06-testing-backend.html" /> <meta property="og:site_name" content="Fullstack JS" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Refactorización con pruebas I" /> <script type="application/ld+json"> {"url":"/docs/06-testing-backend.html","@type":"WebPage","headline":"Refactorización con pruebas I","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> Fullstack JS </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Inicio</a></li><li class="nav-list-item"><a href="/docs/01-vue-cli-install.html" class="nav-list-link">Creando proyecto con CLI</a></li><li class="nav-list-item"><a href="/docs/02-bdd-with-cypress.html" class="nav-list-link">Historias de usuario y BDD</a></li><li class="nav-list-item"><a href="/docs/03-monorepo-backend.html" class="nav-list-link">Fullstack Javascript</a></li><li class="nav-list-item"><a href="/docs/04-firebase-sdk-backend.html" class="nav-list-link">Autenticación en backend</a></li><li class="nav-list-item"><a href="/docs/05-database-sequelize.html" class="nav-list-link">Base de datos en desarrollo</a></li><li class="nav-list-item active"><a href="/docs/06-testing-backend.html" class="nav-list-link active">Refactorización con pruebas I</a></li><li class="nav-list-item"><a href="/docs/07-testing-frontend.html" class="nav-list-link">Refactorización con pruebas II</a></li><li class="nav-list-item"><a href="/docs/08-development-workflow-husky.html" class="nav-list-link">Automatización en desarrollo</a></li><li class="nav-list-item"><a href="/docs/09-deployment-postgres.html" class="nav-list-link">Deploy automatizado</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Fullstack JS" aria-label="Search Fullstack JS" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 id="refactorización-utilizando-pruebas-de-software-en-backend"> <a href="#refactorización-utilizando-pruebas-de-software-en-backend" class="anchor-heading" aria-labelledby="refactorización-utilizando-pruebas-de-software-en-backend"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Refactorización utilizando pruebas de software en Backend </h1> <p>En este punto la funcionalidad ya está completa, pero la organización del código se puede mejorar para aumentar su flexibilidad a los cambios que inevitablemente llegarán.</p> <p>Para esto necesitamos una forma de asegurar que no romperemos nada de lo que hemos logrado. La funcionalidad se debe mantener, pero la calidad del código debe aumentar. Para esto agregaremos pruebas de software para el código tanto en el Backend como en el Frontend.</p> <h3 id="pruebas-de-software-en-backend"> <a href="#pruebas-de-software-en-backend" class="anchor-heading" aria-labelledby="pruebas-de-software-en-backend"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pruebas de software en Backend </h3> <p>Utilizaremos tres herramientas populares de Javascript para escribir y ejecutar pruebas: <code class="language-plaintext highlighter-rouge">jest</code>, <code class="language-plaintext highlighter-rouge">jest-cli</code> y <code class="language-plaintext highlighter-rouge">supertest</code>. Primero navegamos a la carpeta <code class="language-plaintext highlighter-rouge">/backend</code> y luego ejecutamos el siguiente comando:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i <span class="nt">--save-dev</span> jest jest-cli supertest 
</code></pre></div></div> <p>Al igual que como lo hicimos con Sequelize-cli, vamos a exponer el comando de Jest para no tener que instalarlo globalmente. Eso es en el archivo <code class="language-plaintext highlighter-rouge">backend/package.json</code>. También vamos a cambiar el comando de test que viene por defecto. El archivo quedaría de la siguiente forma:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="p">...</span>
  <span class="dl">"</span><span class="s2">scripts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nodemon src/server.js</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">jest --runInBand --coverage</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">jest</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">jest</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">sequelize</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">sequelize</span><span class="dl">"</span>
  <span class="p">},</span>
<span class="p">...</span>
</code></pre></div></div> <p>Jest tiene la opción –init para configurar el entorno de pruebas. El comando a ejecutar es el siguiente: <code class="language-plaintext highlighter-rouge">npm run jest -- --init</code> Esto nos hará una pequeña serie de preguntas que debemos responder con lo siguiente:</p> <p><img src="images/06-testing-frontend-backend-01.png" alt="jest --init" /></p> <p>Ahora continuaremos configurando una base de datos exclusivamente para la ejecución de pruebas. Para esto modificamos el archivo <code class="language-plaintext highlighter-rouge">backend/src/config/config.json</code> en la sección “test”.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">root</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">...</span>
  <span class="dl">"</span><span class="s2">host</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test.database.sqlite3</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">dialect</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">sqlite</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">logging</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">},</span>
</code></pre></div></div> <p>Durante la ejecución de las pruebas se creará una nueva bases de datos que no necesitamos incluir en el repositorio, por lo que agregaremos el nombre de la base de datos de prueba <code class="language-plaintext highlighter-rouge">test.database.sqlite3</code> al <code class="language-plaintext highlighter-rouge">.gitignore</code>.</p> <p>Para probar el backend vamos a crear la carpeta <code class="language-plaintext highlighter-rouge">/tests</code> dentro del directorio <code class="language-plaintext highlighter-rouge">backend</code> y crearemos una prueba simple para revisar que esté todo bien configurado. A este archivo lo llamaremos <code class="language-plaintext highlighter-rouge">auth.test.js</code> ya que es la primera funcionalidad de describimos de nuestro servidor. Su contenido es el siguiente:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/server</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Auth middleware</span><span class="dl">'</span><span class="p">,()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">works</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>

</code></pre></div></div> <p>Esto lo ejecutamos con el comando que configuramos <code class="language-plaintext highlighter-rouge">npm test</code>. La salida en la terminal de esta ejecución es la siguiente:</p> <p><img src="images/06-testing-frontend-backend-02.png" alt="error-async" /></p> <p>Tenemos resultados confusos, ya que en concreto la prueba si pasa, pero vemos una indicación en rojo de que estamos ejecutando <code class="language-plaintext highlighter-rouge">console.log</code>. En este caso es Express en la llamada <code class="language-plaintext highlighter-rouge">app.listen</code> que hace correr un proceso en forma indefinida y jest queda ejecutándose. Entonces debemos separar lo que vamos a probar (la lógica) de lo que ejecuta el servidor (<code class="language-plaintext highlighter-rouge">listen</code>).</p> <p>Logramos esto separando el archivo <code class="language-plaintext highlighter-rouge">server.js</code> para que quede de la siguiente forma:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./app</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span>
<span class="kd">const</span> <span class="nx">environment</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`App server listening in mode </span><span class="p">${</span><span class="nx">environment</span><span class="p">}</span><span class="s2"> on port </span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">})</span>

</code></pre></div></div> <p>El resto del contenido lo agregaremos aun archivo llamado <code class="language-plaintext highlighter-rouge">app.js</code> también en la raíz de Backend con lo siguiente:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">Models</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./models</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="nx">admin</span><span class="p">.</span><span class="nx">initializeApp</span><span class="p">({</span><span class="na">credential</span><span class="p">:</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">credential</span><span class="p">.</span><span class="nx">applicationDefault</span><span class="p">()})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">headerToken</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">authorization</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">headerToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">No token provided</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="p">[</span><span class="nx">authorizationType</span><span class="p">,</span> <span class="nx">tokenValue</span><span class="p">]</span> <span class="o">=</span> <span class="nx">headerToken</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">headerToken</span> <span class="o">&amp;&amp;</span> <span class="nx">authorizationType</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">bearer</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Invalid token</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">auth</span><span class="p">().</span><span class="nx">verifyIdToken</span><span class="p">(</span><span class="nx">tokenValue</span><span class="p">)</span>
    <span class="nx">next</span><span class="p">()</span>

  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>

    <span class="nx">response</span>
      <span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Could not authorize</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/products</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
  <span class="kd">const</span> <span class="nx">Product</span> <span class="o">=</span> <span class="nx">Models</span><span class="p">.</span><span class="nx">Product</span><span class="p">;</span>
  
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">products</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Product</span><span class="p">.</span><span class="nx">findAll</span><span class="p">()</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`GET with status code </span><span class="p">${</span><span class="nx">statusCode</span><span class="p">}</span><span class="s2"> in /api/products endpoint`</span><span class="p">)</span>

    <span class="k">return</span> <span class="nx">response</span>
      <span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">statusCode</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">products</span><span class="p">)</span>

  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">message</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">error</span>
    <span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`GET with status code </span><span class="p">${</span><span class="nx">statusCode</span><span class="p">}</span><span class="s2"> in /api/products endpoint. Error: </span><span class="p">${</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nx">response</span>
      <span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">statusCode</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">app</span>

</code></pre></div></div> <p>Y modificamos la prueba para requerir el archivo <code class="language-plaintext highlighter-rouge">app.js</code>:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/app</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Auth middleware</span><span class="dl">'</span><span class="p">,()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">works</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>

</code></pre></div></div> <p>Con estos ajustes la salida de las pruebas queda como indica la siguiente imagen:</p> <p><img src="images/06-testing-frontend-backend-03.png" alt="jest simple test passing" /></p> <h4 id="casos-de-la-funcionalidad-para-definir-pruebas"> <a href="#casos-de-la-funcionalidad-para-definir-pruebas" class="anchor-heading" aria-labelledby="casos-de-la-funcionalidad-para-definir-pruebas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Casos de la funcionalidad para definir pruebas </h4> <p>En este momento el servidor tiene las siguientes características:</p> <ul> <li>Valida que las solicitudes a <code class="language-plaintext highlighter-rouge">/api</code> estén autenticadas con 4 casos posibles. 3 casos en los cuales respondemos un código de error y uno en el cuál resulta exitoso y se deja pasar la solicitud.</li> </ul> <p>EL resumen el archivo server tiene los siguientes bloques de código para cada uno de los casos.</p> <p><strong>backend/src/server.js</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">headerToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Caso 1 error: no se envía la cabecera "Authorization"</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">headerToken</span> <span class="o">&amp;&amp;</span> <span class="nx">authorizationType</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">bearer</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Caso 2 error: se envía una cabecera "Authorization" que no es del tipo "Bearer"</span>
  <span class="p">}</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Caso 3 éxito: La solicitud fue validada exitosamente</span>
    <span class="c1">// y la solicitud ingresa al servidor ejecutando la función "next"</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Caso 4 error: La librería "firebase-admin" no valida el token enviado</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div> <ul> <li>Las solicitudes ya autenticadas que consultan <code class="language-plaintext highlighter-rouge">/api/products</code> pueden tener 2 casos posibles al hacer consultas a la base de datos.</li> </ul> <p><strong>backend/src/server.js</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/products</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Caso 1 éxito: Se consulta la base de datos exitosamente </span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Caso 2 error: Ocurre un error al consultar la base de datos</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div> <p>Estas son las funcionalidades que debemos mantener y que deben resistir el proceso de refactorización.</p> <p>Es una buena práctica primero previsualizar los casos a los cuales vamos a escribir las pruebas así tenemos claro que código está involucrado en cada uno de los casos y será más fácil escribir la implementación de la prueba.</p> <h4 id="implementación-de-pruebas-sobre-el-middleware-de-validación-de-solicitudes-autorizadas"> <a href="#implementación-de-pruebas-sobre-el-middleware-de-validación-de-solicitudes-autorizadas" class="anchor-heading" aria-labelledby="implementación-de-pruebas-sobre-el-middleware-de-validación-de-solicitudes-autorizadas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implementación de pruebas sobre el Middleware de validación de solicitudes autorizadas </h4> <p>Vamos a escribir las pruebas que definimos para los casos que describimos anteriormente.</p> <h5 id="caso-1-error-no-se-envía-la-cabecera-authorization"> <a href="#caso-1-error-no-se-envía-la-cabecera-authorization" class="anchor-heading" aria-labelledby="caso-1-error-no-se-envía-la-cabecera-authorization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Caso 1 error: no se envía la cabecera “Authorization” </h5> <p>Resultado esperado</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Retorna 401 y un mensaje "No token provided" cuando no viene la cabecera de autorización
</code></pre></div></div> <p>Vamos a escribir el código para representar este caso como indica el siguiente código:</p> <p><strong>backend/tests/auth.test.js</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">supertest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">supertest</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/app</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Auth middleware</span><span class="dl">'</span><span class="p">,()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">returns 401 when there is no authorization header</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">supertest</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/any-endpoint</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">No token provided</span><span class="dl">"</span> <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>Podemos notar como a partir de la librería <code class="language-plaintext highlighter-rouge">Supertest</code> podemos simular una solicitud al servidor sin necesidad de crear una real pasándole el módulo de express que en nuestro caso se exporta a través del valor <code class="language-plaintext highlighter-rouge">app</code>. Esto permite a <code class="language-plaintext highlighter-rouge">Supertest</code> conocer la configuración de las rutas que hemos definido para nuestros endpoints y hacer la simulación.</p> <p>En adelante vamos a complementar este archivo agregando los bloques <code class="language-plaintext highlighter-rouge">it</code> dentro del bloque <code class="language-plaintext highlighter-rouge">describe</code> en el mismo orden que hicimos nuestro análisis</p> <h5 id="caso-2-error-se-envía-una-cabecera-authorization-que-no-es-del-tipo-bearer"> <a href="#caso-2-error-se-envía-una-cabecera-authorization-que-no-es-del-tipo-bearer" class="anchor-heading" aria-labelledby="caso-2-error-se-envía-una-cabecera-authorization-que-no-es-del-tipo-bearer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Caso 2 error: se envía una cabecera “Authorization” que no es del tipo “Bearer” </h5> <p>Resultado esperado</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Retorna 401 y un mensaje "Invalid token" cuando el token no es de tipo Bearer
</code></pre></div></div> <p>El código que representa este caso es como indica el siguiente código:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">returns 401 when the token is not a bearer token</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span><span class="o">=&gt;</span><span class="p">{</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">supertest</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
    <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/fake</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">Token faketoken</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Invalid token</span><span class="dl">'</span> <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <h5 id="caso-3-éxito-la-solicitud-fue-validada-exitosamente-y-la-solicitud-ingresa-al-servidor-ejecutando-la-función-next"> <a href="#caso-3-éxito-la-solicitud-fue-validada-exitosamente-y-la-solicitud-ingresa-al-servidor-ejecutando-la-función-next" class="anchor-heading" aria-labelledby="caso-3-éxito-la-solicitud-fue-validada-exitosamente-y-la-solicitud-ingresa-al-servidor-ejecutando-la-función-next"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Caso 3 éxito: La solicitud fue validada exitosamente y la solicitud ingresa al servidor ejecutando la función “next” </h5> <p>Resultado esperado</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Al validar el token deja pasar la petición ejecutando la función "next"
</code></pre></div></div> <p>Este caso no lo implementaremos acá ya que cuando hagamos las pruebas del endpoint <code class="language-plaintext highlighter-rouge">GET /api/products</code> estaremos pasando por este middleware y será implícito que la prueba pasa por la función <code class="language-plaintext highlighter-rouge">next</code></p> <h5 id="caso-4-error-la-librería-firebase-admin-no-valida-el-token-enviado"> <a href="#caso-4-error-la-librería-firebase-admin-no-valida-el-token-enviado" class="anchor-heading" aria-labelledby="caso-4-error-la-librería-firebase-admin-no-valida-el-token-enviado"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Caso 4 error: La librería “firebase-admin” no valida el token enviado </h5> <p>Resultado esperado</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Retorna 403 y un mensaje "Could not authorize" cuando el token es de tipo Bearer, pero no es válido
</code></pre></div></div> <p>En este caso debemos crear un mock de la librería <code class="language-plaintext highlighter-rouge">firebase-admin</code> para simular que el llamado al método <code class="language-plaintext highlighter-rouge">verifyIdToken</code> tome el comportamiento que necesitemos para la prueba. Primero modificaremos las funciones que utilizamos de <code class="language-plaintext highlighter-rouge">firebase-admin</code> para que la prueba se ejecute sin errores:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">supertest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">supertest</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/app</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">auth</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">mockReturnValue</span><span class="p">({</span> <span class="na">verifyIdToken</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span> <span class="p">}),</span>
  <span class="na">credential</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">applicationDefault</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(),</span>
  <span class="p">},</span>
  <span class="na">initializeApp</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span>
<span class="p">}))</span>
<span class="p">...</span>
</code></pre></div></div> <p>Ahora sí podemos agregar el último <code class="language-plaintext highlighter-rouge">it</code> en el que forzaremos un rechazo de la promesa en la función <code class="language-plaintext highlighter-rouge">verifyIdToken</code>, para simular que se entregó un token inválido.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">returns 403 when an invalid token is passed</span><span class="dl">'</span><span class="p">,</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">admin</span><span class="p">.</span><span class="nx">auth</span><span class="p">().</span><span class="nx">verifyIdToken</span><span class="p">.</span><span class="nx">mockRejectedValue</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">())</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">supertest</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/fake</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Bearer faketoken</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Could not authorize</span><span class="dl">'</span> <span class="p">})</span>
<span class="p">})</span>

</code></pre></div></div> <p>Ejecutamos y vemos que en la ultima prueba jest incluso nos muestra el <code class="language-plaintext highlighter-rouge">console.error</code> que se debe ejecutar en el código de la aplicación cuando llega un token inválido. Lo puedes ver en el siguiente screenshot:</p> <p><img src="images/06-testing-frontend-backend-04.png" alt="jest auth test" /></p> <p>Con todo lo anterior el código completo del archivo <code class="language-plaintext highlighter-rouge">auth.test.js</code> queda de la siguiente forma:</p> <p><strong>backend/tests/auth.test.js</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">supertest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">supertest</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/app</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">auth</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockReturnValue</span><span class="p">({</span> <span class="na">verifyIdToken</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span> <span class="p">}),</span>
  <span class="na">credential</span><span class="p">:</span> <span class="p">{</span>
  <span class="na">applicationDefault</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(),</span>
  <span class="p">},</span>
  <span class="na">initializeApp</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span>
<span class="p">}))</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Auth middleware</span><span class="dl">'</span><span class="p">,()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">returns 401 when there is no authorization header</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">supertest</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/fake</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">No token provided</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">})</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">returns 401 when the token is not a bearer token</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span><span class="o">=&gt;</span><span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">supertest</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/fake</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">Token faketoken</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Invalid token</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">})</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">returns 403 when an invalid token is passed</span><span class="dl">'</span><span class="p">,</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">admin</span><span class="p">.</span><span class="nx">auth</span><span class="p">().</span><span class="nx">verifyIdToken</span><span class="p">.</span><span class="nx">mockRejectedValue</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">());</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">supertest</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/fake</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Bearer faketoken</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Could not authorize</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>

</code></pre></div></div> <p>Antes de continuar vamos a echar un vistazo a una nueva carpeta que se ha creado en la raíz del directorio <code class="language-plaintext highlighter-rouge">backend</code> llamada <code class="language-plaintext highlighter-rouge">coverage</code>. En su interior veremos otro directorio llamado <code class="language-plaintext highlighter-rouge">lcov-report</code> y en su interior un archivo <code class="language-plaintext highlighter-rouge">index.html</code> Si lo abrimos con un navegador web veremos algo como lo siguiente:</p> <p><img src="images/06-testing-frontend-backend-05.png" alt="Imagen que muestra reporte de cobertura en el navegador" /></p> <p>Luego si hacemos click en <code class="language-plaintext highlighter-rouge">src</code> y luego en <code class="language-plaintext highlighter-rouge">app.js</code> veremos lo que muestra la siguiente imagen:</p> <p><img src="images/06-testing-frontend-backend-06.png" alt="Imagen que muestra reporte de cobertura en el navegador" /></p> <p>Podemos ver claramente como es que el informe de cobertura nos muestra que aún no hemos escrito pruebas que ejecuten los códigos remarcados en la imagen.</p> <p>⚠️ Ahora vamos a agregar al archivo <code class="language-plaintext highlighter-rouge">.gitignore</code> el directorio <code class="language-plaintext highlighter-rouge">coverage</code> porque es importante que este informe sea regenerado por cada ejecución de las pruebas pero no lo necesitamos como parte del repositorio.</p> <p>Seguimos adelante con las pruebas cuando la solicitud pasa el middleware de autorización y solicita el listado de productos.</p> <h4 id="implementación-de-pruebas-para-endpoints-de-productos"> <a href="#implementación-de-pruebas-para-endpoints-de-productos" class="anchor-heading" aria-labelledby="implementación-de-pruebas-para-endpoints-de-productos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implementación de pruebas para endpoints de productos </h4> <p>Vamos a escribir las pruebas del endpoint <code class="language-plaintext highlighter-rouge">GET /api/products</code>:</p> <h5 id="caso-1-éxito-se-consulta-la-base-de-datos-exitosamente"> <a href="#caso-1-éxito-se-consulta-la-base-de-datos-exitosamente" class="anchor-heading" aria-labelledby="caso-1-éxito-se-consulta-la-base-de-datos-exitosamente"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Caso 1 éxito: Se consulta la base de datos exitosamente </h5> <p>Resultado esperado</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Retorna 200 y una lista de productos que previamente fueron insertados en la base de datos
</code></pre></div></div> <p>Haremos un nuevo archivo dentro del directorio <code class="language-plaintext highlighter-rouge">backend/tests</code> llamado <code class="language-plaintext highlighter-rouge">products.test.js</code>.</p> <p>Este es un caso más complejo, porque debemos simular (usando dobles de prueba) que la solicitud cumple con los requisitos de autorización, de otra forma nuestro código no se ejecutará. Además necesitamos probar que la aplicación entrega el arreglo de productos definido en los Fixtures, por lo que hay agregar estos datos a la BDD antes de enviar la solicitud. Esto lo podemos lograr con las funciones <code class="language-plaintext highlighter-rouge">beforeAll</code> y <code class="language-plaintext highlighter-rouge">afterAll</code> que se ejecutarán al inicio y al final de todas las pruebas respectivamente con el objetivo de sincronizar la base de datos y correr las migraciones a través de <code class="language-plaintext highlighter-rouge">Models.sequelize.sync</code>.</p> <p>La prueba queda de la siguiente forma:</p> <p><strong>backend/tests/products.test.js</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">supertest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">supertest</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/app</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">Models</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../src/models</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">productsFixture</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../../fixtures/products.json</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">auth</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockReturnValue</span><span class="p">({</span> <span class="na">verifyIdToken</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span> <span class="p">}),</span>
  <span class="na">credential</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">applicationDefault</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(),</span>
  <span class="p">},</span>
  <span class="na">initializeApp</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span>
<span class="p">}))</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/products</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span><span class="p">{</span>

  <span class="nx">beforeAll</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">Models</span><span class="p">.</span><span class="nx">sequelize</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span> <span class="na">force</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
    <span class="nx">admin</span><span class="p">.</span><span class="nx">auth</span><span class="p">().</span><span class="nx">verifyIdToken</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">returns an array of products</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">Models</span><span class="p">.</span><span class="nx">Product</span><span class="p">.</span><span class="nx">bulkCreate</span><span class="p">(</span><span class="nx">productsFixture</span><span class="p">)</span>
    
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">supertest</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/products</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Bearer valid-token</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">(</span><span class="nx">productsFixture</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nx">afterAll</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">Models</span><span class="p">.</span><span class="nx">sequelize</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
  <span class="p">})</span>
<span class="p">})</span>

</code></pre></div></div> <h5 id="caso-2-error-ocurre-un-error-al-consultar-la-base-de-datos"> <a href="#caso-2-error-ocurre-un-error-al-consultar-la-base-de-datos" class="anchor-heading" aria-labelledby="caso-2-error-ocurre-un-error-al-consultar-la-base-de-datos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Caso 2 error: Ocurre un error al consultar la base de datos </h5> <p>Resultado esperado</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Retorna 500 y un mensaje con el error de la base de datos
</code></pre></div></div> <p>Para hacer que la base de datos falle, lo que haremos será destruir la table <code class="language-plaintext highlighter-rouge">Products</code> a través de Sequelize utilizando el método <code class="language-plaintext highlighter-rouge">drop</code>. Agregaremos el siguiente bloque <code class="language-plaintext highlighter-rouge">it</code> bajo del que ya escribimos en el archivo <code class="language-plaintext highlighter-rouge">backend/tests/products.test.js</code></p> <p><strong>backend/tests/auth.test.js</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">returns 500 when the database throws error</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">Models</span><span class="p">.</span><span class="nx">Product</span><span class="p">.</span><span class="nx">drop</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">supertest</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/products</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Bearer valid-token</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SQLITE_ERROR: no such table: Products</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">})</span>
</code></pre></div></div> <p>al correr el comando <code class="language-plaintext highlighter-rouge">npm test</code> deberíamos ver todas las pruebas pasando como muestra la siguiente imagen:</p> <p><img src="images/06-testing-frontend-backend-07.png" alt="Imagen que muestra todas las pruebas de Backend pasando" /></p> <p>Podemos validar que ahora estamos cubriendo toda la funcionalidad construida hasta el momento con nuestras pruebas revisando tal como lo hicimos anteriormente en el archivo en el directorio <code class="language-plaintext highlighter-rouge">coverage</code>.</p> <p><img src="images/06-testing-frontend-backend-08.png" alt="Imagen que muestra la cobertura de las pruebas en el archivo app.js" /></p> <p>Ahora con toda nuestra funcionalidad cubierta con las pruebas pasando, volvemos a refactorizar para dividir los controladores, middleware y rutas siguiendo los guías SOLID.</p> <p>Vamos a re-estructurar el proyecto para que quede de la siguiente forma</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;backend&gt;
├── coverage
├── node_modules
├── src
    ├── config
    ├── controllers &lt;<span class="nt">--</span> directorio nuevo y archivo
        products.js
    ├── middleware &lt;<span class="nt">--</span> directorio nuevo y archivo
        auth.js
    ├── migrations
    ├── models
    ├── routes &lt;<span class="nt">--</span> directorio nuevo y archivo
        index.js
    ├── seeders
    app.js
    server.js
├── tests
    auth.test.js
    products.test.js
.sequelizesrc
firebase-service-account.json
jest.config.js
local.database.sqlite3
nodemon.json
package-lock.json
package.json
test.database.sqlite3
</code></pre></div></div> <p>Ahora vamos a mostrar el contenido de los 4 archivos involucrados en la refactorización</p> <p><strong>backend/controllers/products.js</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Models</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../models</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">Product</span> <span class="o">=</span> <span class="nx">Models</span><span class="p">.</span><span class="nx">Product</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="k">async</span> <span class="nx">index</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">products</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Product</span><span class="p">.</span><span class="nx">findAll</span><span class="p">()</span>
  
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`GET with status code </span><span class="p">${</span><span class="nx">statusCode</span><span class="p">}</span><span class="s2"> in /api/products endpoint`</span><span class="p">)</span>
  
      <span class="k">return</span> <span class="nx">response</span>
        <span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">statusCode</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">products</span><span class="p">)</span>
  
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="p">{</span> <span class="nx">message</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">error</span>
      <span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">500</span>
  
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`GET with status code </span><span class="p">${</span><span class="nx">statusCode</span><span class="p">}</span><span class="s2"> in /api/products endpoint. Error: </span><span class="p">${</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      
      <span class="k">return</span> <span class="nx">response</span>
        <span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="nx">statusCode</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div> <p><strong>backend/middleware/auth.js</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">admin</span><span class="p">.</span><span class="nx">initializeApp</span><span class="p">({</span> <span class="na">credential</span><span class="p">:</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">credential</span><span class="p">.</span><span class="nx">applicationDefault</span><span class="p">()</span> <span class="p">})</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">headerToken</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">authorization</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">headerToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">No token provided</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="p">[</span><span class="nx">authorizationType</span><span class="p">,</span> <span class="nx">tokenValue</span><span class="p">]</span> <span class="o">=</span> <span class="nx">headerToken</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">headerToken</span> <span class="o">&amp;&amp;</span> <span class="nx">authorizationType</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">bearer</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Invalid token</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">auth</span><span class="p">().</span><span class="nx">verifyIdToken</span><span class="p">(</span><span class="nx">tokenValue</span><span class="p">)</span>
    <span class="nx">next</span><span class="p">()</span>

  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>

    <span class="nx">response</span>
      <span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Could not authorize</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div> <p><strong>backend/routes/index.js</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">productsController</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../controllers/products</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/products</span><span class="dl">'</span><span class="p">,</span> <span class="nx">productsController</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span>

</code></pre></div></div> <p><strong>backend/app.js</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">authMiddleware</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./middleware/auth</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">routes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./routes</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">,</span> <span class="nx">authMiddleware</span><span class="p">)</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">,</span> <span class="nx">routes</span><span class="p">)</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">app</span>

</code></pre></div></div> <p>Volvemos a correr el comando <code class="language-plaintext highlighter-rouge">npm test</code> y veremos que el informe de cobertura nos muestra la nueva distribución de los archivos que fueron ejecutados en las pruebas.</p> <p><img src="images/06-testing-frontend-backend-09.png" alt="Imagen que muestra la cobertura de las pruebas en la terminal" /></p> <p>De esta manera logramos hacer una refactorización para ordenar y preparar al código del servidor para ser más escalable para los futuros incrementos del código.</p> <p>Momento de un nuevo commit. Escribimos lo siguiente en la terminal:</p> <p>⚠️ Debes están posicionado en la raíz del proyecto.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add <span class="nb">.</span>
git commit <span class="nt">-m</span> <span class="s2">"refactor(backend-refactor): Se agregó set de pruebas de caracterización en el Backend y luego un refactor para dividir responsabilidades"</span>
</code></pre></div></div> <div class="table-wrapper"><table> <tr> <th colspan="2"> <a href="./05-database-sequelize.md"> <span>⬅️ </span> Agregando base de datos en desarrollo </a> </th> <th colspan="2"> <a href="./07-testing-frontend.md">Pruebas de software para Frontend <span>➡️ </span> </a> </th> </tr> </table></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
